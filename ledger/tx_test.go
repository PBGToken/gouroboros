// Copyright 2023 Blink Labs Software
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package ledger_test

import (
	"encoding/hex"
	"testing"

	"github.com/blinklabs-io/gouroboros/ledger"
)

func TestDetermineTransactionType(t *testing.T) {
	testDefs := []struct {
		name           string
		txCborHex      string
		expectedTxType uint
	}{
		{
			name:           "ConwayTx",
			txCborHex:      "84a500d9010281825820279184037d249e397d97293738370756da559718fcdefae9924834840046b37b01018282583900923d4b64e1d730a4baf3e6dc433a9686983940f458363f37aad7a1a9568b72f85522e4a17d44a45cd021b9741b55d7cbc635c911625b015e1a00a9867082583900923d4b64e1d730a4baf3e6dc433a9686983940f458363f37aad7a1a9568b72f85522e4a17d44a45cd021b9741b55d7cbc635c911625b015e1b00000001267d7b04021a0002938d031a04e304e70800a100d9010281825820b829480e5d5827d2e1bd7c89176a5ca125c30812e54be7dbdf5c47c835a17f3d5840b13a76e7f2b19cde216fcad55ceeeb489ebab3dcf63ef1539ac4f535dece00411ee55c9b8188ef04b4aa3c72586e4a0ec9b89949367d7270fdddad3b18731403f5f6",
			expectedTxType: 6,
		},
		{
			name:           "ByronTx",
			txCborHex:      "839f8200d8185824825820a12a839c25a01fa5d118167db5acdbd9e38172ae8f00e5ac0a4997ef792a200700ff9f8282d818584283581c6c9982e7f2b6dcc5eaa880e8014568913c8868d9f0f86eb687b2633ca101581e581c010d876783fb2b4d0d17c86df29af8d35356ed3d1827bf4744f06700001a8dc672c11a000f4240ffa0",
			expectedTxType: 0,
		},
		{
			name:           "ConwayTx",
			txCborHex:      "84a700d90102828258205c6561c47415ca5ae6e2060237c748f45fb2c914202ecf9e094bd6718556214104825820d9787063a8871d8ab5908a4abae3e826175ab9d82cc1bcd80f87a0940dc26621000183a300581d70d12d6cb72d61334d8234173400b32d457d8fe7a0c2dea6bb1bae27e401821a002f9d38a1581cd12d6cb72d61334d8234173400b32d457d8fe7a0c2dea6bb1bae27e4a149000643b0705041584701028201d8185901d9d8799fae46737570706c79c24901e88349911936400044747970654c5772617070656441737365744576656e756548457468657265756d46706f6c696379582a307834353830343838304465323239313364414645303966343938303834384543453645636241663738476163636f756e74582a307837324235303936314232373437346244333632414363463936386166303166336338323863336432467469636b6572457050415847446e616d654d577261707065642070504158474b6465736372697074696f6e582057726170706564207050415847206f70657261746564206279205042472e696f48646563696d616c73124375726c4e68747470733a2f2f7062672e696f446c6f676f582868747470733a2f2f70726570726f642e706267746f6b656e2e696f2f7277612d6c6f676f2e706e674671756f72756d02476f7261636c65739f581c80edfa909a3d40a54fca4c3ee852c7ba2a79391738911dc363580dc2581cab25d3b9476a3e3343a2f353b08b40913c573de7d286ef37ac4013e0581c7bd1ebc8230f961193fb772204542e85425af4f7a8f36acb5543da08ff4473656564d8799fd8799f58201354abe2667f15d1341b59b82c6204228b4c885f4bff659fcf5cb97b224b05adff04ff01d87980ffa2005839003a5904074323a4cddfe1103969962a5807c6c37495db9df48d019f9a5a0987ee3ec775d90cb16851a5f3cc9d8b03bd6492329e893684422901821a00127ae6a1581cd12d6cb72d61334d8234173400b32d457d8fe7a0c2dea6bb1bae27e4a1490014df107050415847c24901e883499119364000a200581d60a3527f67e636f3200fef95378e2ef12e86f1a6366cc87734945d46d2011a01f8f516021a0009743c09a1581cd12d6cb72d61334d8234173400b32d457d8fe7a0c2dea6bb1bae27e4a1490014df107050415847c24901e8834991193640000b5820c12fbb1f2f6011f829306895c39103b3528c8d7d9e70a2d4815eaef3eb9e20260dd9010281825820af6a376710f1740750c009b7e102310665da0f68288f20d4cbd65a6a76b3a845000ed9010283581c7bd1ebc8230f961193fb772204542e85425af4f7a8f36acb5543da08581c80edfa909a3d40a54fca4c3ee852c7ba2a79391738911dc363580dc2581cab25d3b9476a3e3343a2f353b08b40913c573de7d286ef37ac4013e0a300d9010284825820db5155671d34ae8c304ed430d2c3d178db8a6d4feb9eefa842c2b26bfd1c65c7584014048b77e09ce4370fd2671ebe71e7fd5f8eb6e9dfac3c3ecbcaaab8c82bc62db6bd80b266c7a21215a5c54b31c0cf9fdb2369e893967c1bd8c5b9cce7fa26018258208d9578fed65af1d1ce74b1c27e8be3dfe98490157382be39b0b6cb33c268d7785840e2ed2ffb292bc8301cbf79ab411b793503dd2ebba7e53901f8dd941398970a8a6a556594c640b86e6432839e0f41b29bdf6ef86370be3175bce53b55acec7e0d825820e72ce3641ee15563ad0aad3b4b56e574608d02a55aa5b5914a982470ce8581bb58409f90766ff70b07b7d497403173952b909c948341f72f1ebdd448fd51f471faf87e12c9bd0791691b5f708419a6502db5516facb81a6d815f3d4cac15e26ffc0d825820f5652f172258d6d0b0feeafb6bfc7a6635570c01eabcb9736ad06b1475c679f85840d636048f918f112859152d5f2024386795b600c2ca149c86c71e2e47f59cea0894d43cf769c24d2b1c7a017425c92f41caac561c475cf2f50e501aee99e6dd0f0582840100d8799f00ff821a00016bb61a02008219840001d87a9fc24901e883499119364000ff821a002528ce1a34069e2406d901028159102f59102c0100002232325333573466e1cd55ce801240002646600400200866e9520003357406ae84d55cf1baa0044bd7009911980180100099ba548008cd5d000219aba0357426aae780092f5c044646464646464646464646464646464646464646464646464646464646a666ae68cdc39aab9d375403c9001091919192999aab9f00114984cc014004894ccd5cd19b8f00248909000643b0705041584700132323233573664a666ae68004526163372e602a0029210c5772617070656441737365740033573664a666ae68004526163372e6028002602800666ae6cc94ccd5cd0008a4c2c66e5cc04c004c04c00ccd5cd992999ab9a001149858cdcb9809000980900199ab9b32533357340022930b19b973011001301100333573664a666ae68004526163370e6020002602000666ae6cc94ccd5cd0008a4c2c66e1cdd69980e000a4410671756f72756d0048010cd5cd992999ab9a001149858c8cdd79ba70014c015c9f581c80edfa909a3d40a54fca4c3ee852c7ba2a79391738911dc363580dc2581cab25d3b9476a3e3343a2f353b08b40913c573de7d286ef37ac4013e0581c7bd1ebc8230f961193fb772204542e85425af4f7a8f36acb5543da08ff003758660380029101076f7261636c65730033573664a666ae68004526163375e660380029110473656564004c012bd8799fd8799f58201354abe2667f15d1341b59b82c6204228b4c885f4bff659fcf5cb97b224b05adff04ff00323232335736a666ae68cdc399b810010020031498594ccd5cd199ab9a3371200690002504a2266ae6d4ccd5cd19b8900100b149858c94ccd5cd0008a4c2c64666ae68cdc4000a40089412899199800800a5eb851e581c80edfa909a3d40a54fca4c3ee852c7ba2a79391738911dc363580dc200811e581cab25d3b9476a3e3343a2f353b08b40913c573de7d286ef37ac4013e000811e581c7bd1ebc8230f961193fb772204542e85425af4f7a8f36acb5543da080024000444a666aae7c00840044ccc00c00cd5d10011919b80002323335734002900124000646604c6eb0d5d09aba2357446ae88d5d11aba2357446ae88d5d11aab9e3754056466ebc004008dd48009bae357420042931bad3301e00348906737570706c7900375a6603a008910106737570706c790033021302002300d32357426aae78dd50009805980f1aba1357446ae88d55cf1baa0013300937586ae84d5d11aba235573c6ea808494ccd5cd19baf357426aae78dd5000807099199ab9a3371200290002504a2660406eacd5d09aba235573c6ea8004034528191aba135573c6ea8004c070c8d5d09aba2357446aae78dd50009aba1357446aae78dd50020b1980f991bab357426ae88d55cf1baa001357426ae88d55cf1baa001010501b375a6ae84d5d11aab9e3754002246466006002446466ae6d4ccd55cf8008a4c2ca666ae694ccd5cd19b8f003489090014df107050415847001333573466e1c00920004a09445280992999ab9a001149858cc068dd61aba135573c6ea807c94ccd5cd19baf32357426aae78dd50009aba1357446aae78dd5000806099199ab9a3371200290002504a26603c646eacd5d09aba235573c6ea8004d5d09aba235573c6ea800402c5280a999ab9a5333573466e1c009200213371e00691109000643b070504158470014a0266ae6cc94ccd5cd0008a4c2c660346eb0d5d09aab9e375403e466ebcd5d09aab9e375400298012bd8799fd8799f58201354abe2667f15d1341b59b82c6204228b4c885f4bff659fcf5cb97b224b05adff04ff0032323233573664a666ae68004526163370e6eb4cc06c00522106737570706c790048000cd5cd992999ab9a001149858cdcb980a000a4810c5772617070656441737365740033573664a666ae68004526163372e6026002920108457468657265756d0033573664a666ae68004526163372e602400292012a3078343538303438383044653232393133644146453039663439383038343845434536456362416637380033573664a666ae68004526163372e602200292012a3078373242353039363142323734373462443336324143634639363861663031663363383238633364320033573664a666ae68004526163372e602000292010570504158470033573664a666ae68004526163370e601e002901219ab9b32533357340022930b19b87375a660360029110671756f72756d0048010cd5cd992999ab9a001149858cdd79980d800a450473656564004c012bd8799fd8799f58201354abe2667f15d1341b59b82c6204228b4c885f4bff659fcf5cb97b224b05adff04ff0033573664a666ae68004526163370e6eb4d5d09aba235573c6ea8009200232533357340022930b19baf357426ae88d5d11aab9e375400498103d8798000357426aae78dd50009804980e1aba1357446ae88d55cf1baa0013300737586ae84d5d11aba235573c6ea807c94ccd5cd19baf357426aae78dd5000806099b873301e37566ae84d5d11aab9e375400201690010a5016357440066603a603003601c03c4644660026eb8d55ce8011bad35573c0046ae8400488c8cc00400400c894ccd55cf8008b0992999ab9a30040011001133003003357440046ae8400494ccd5cd2999ab9a53333335748002264a666ae68cdc39aab9d001480004c94cccccd5d20008a5014a0264a666aae7c0045280a999ab9a325333573466602800298105447365656400253333335748002264a666ae68cdc39aab9d001480004c94ccd55cf8008a5015333573464a666666ae900044c8c8c94ccd5cd19b874800000854ccd55cf8008a50153335573e6ae880044cc06920403574200229405281aab9e00235573a0026ea80045280a5014a02940d5d08008992999aab9f00114a02a666ae68cccccd5d21aba10014a0941282514a02a666aae7cd5d10008a5114a02940d5d10008a5035573c0022940dd50008a5014a029405280a999ab9a3330140014c108476f7261636c65730025333333574800229405280991919800800801112999aab9f00114a22a666ae68c050d5d08008998010011aba200114a06eb00045280a50153335734666028002981074671756f72756d0023333335748002941282504a294054ccd5cd19980a000a6105446c6f676f00011153335734666028002981044375726c000111533357346660280029810948646563696d616c730023333335748002941282504a294054ccd5cd19980a000a610c4b6465736372697074696f6e0001115333573466602800298105446e616d650001115333573466602800298107467469636b65720001115333573466602800298108476163636f756e74000111533357346660280029810746706f6c69637900011153335734666028002981064576656e756500011153335734666028002981054474797065000111533357346660280029810746737570706c790023333335748002941282504a29405288a5014a029405280a5014a029405280a5014a029405280a5014a06ae840044c94ccd55cf8008a50153335734666666ae90d5d0800a504a094128a5013253335573e002294054ccd5cd2999ab9a3253333335748002264a666ae68cdc39aab9d001480004c94cccccd5d20008a5014a02666aae7cdd6000a514a029405281ba735573c0022940dd50008a5014a029405281aba100114a229404ccd55cf9aba20014a29405281aba200114a06ae880045281bac00114a02940dd39aab9e00114a06ea80045280a5014a029405288a50100116330100094881090014df107050415847003300f008488109000643b07050415847003374a900019aba03374a900119aba0375200e97ae04bd70903d87a800011bad3300d00148908646563696d616c730023237326eb8004cc0300052201067469636b65720023237326eb8004cc02c0052201076163636f756e740023237326eb8004cc028005220106706f6c6963790023237326eb8004cc02400522010576656e75650023237326eb8004cc0200052201047479706500325333573466e1c00520001375c6ae84d55cf1baa00f15333573466e1c0052002132375c6ae84d55cf1baa001325333573466e1cd55ce9baa00148008400458c8d5d09aab9e3754002646ae84d55cf1baa00132357426ae88d55cf1baa001500d1323232375ca666ae68cdc3801240082646ae84d55cf1baa001357426aae78dd50008991aba135573c6ea8004c8d5d09aab9e37540026ae84d55cf1baa001357426aae78008d55ce8009baa00f35573a6ea8038c00d203825333333574800229405280a5014a02646464660020029000112999ab9a3370e00200629444c94ccd5cd19b89001483f8044cc00c00ccdc0001240042a666ae68cdc399b8300148101200c1325333573466e240040144cc020cdc700319b8000348008894ccd5cd0010992999ab9a5333573466e25208002001133712002907f0f8a5013300700700414a066e00cdc119b860044810120800100114a02940cdc0001240082a666ae68cdc399b8300148081201c1325333573466e240040144cc020cdc700319b8000348008894ccd5cd00109980519b8e0083370000a9002112999ab9a00213253335734a666ae68cdc4a410040002266e2400520feff0714a026601201200c2940cdc019b823370c00c9010241008066e00cdc1001a41000200229405280a503370000490030a999ab9a3370e66e0c0052010480f04c94ccd5cd19b890010051330083371c00c66e0000d2002225333573400426601466e38020cdc0002a400844a666ae680084cc030cdc700519b8000748018894ccd5cd0010992999ab9a5333573466e2520808008001133712002907f7fff808a5013300b00b00814a066e00cdc119b8600848041208080203370066e080152080403370066e0800d20800100114a029405280a503370000490040a503371c0080026e34004dd7000912999ab9a3370e66e0c009208001480104cc0052899b8600248200044cc005282400044a666666ae900045280a5014a0294054ccd5cd19b87371a6eb80040085288a502225333333574800629404c8c8cc004004008894ccd55cf8008a5013232325333573466ebc0080204c01c0044cc014014d5d10021aab9e00235573a0026ae84004dd58018a5014a0294088c8c8c8cc00400400c894ccd55cf8008b09919192999ab9a3375e00400c200226600a00a6ae88010d55cf0011aab9d001357420026ea4008dd58011119ba548000cd5d01ba90023357406ea40052f5c04464666002002006004444a666aae7c0085280a999ab9a30013574200429444ccc00c00cd5d100100091919192999ab9a3370e004900209aba10011635573c0046aae74004dd500091bab357426ae88d5d11aba2357446aae78dd500091191919199800800912999aab9f00114800054ccd5cd19baf35573a6ae840040104dd69aab9e357420022660040046ae880040148894ccd55cf8008a40002a666ae68cdd79aab9d3574200200a2660040046eacd55cf1aba10011333003003002357440026ae84d5d11aab9e37540046ae84d55cf1baa001132323300100137586ae84d55cf1baa0032253335573e0022c264a666ae68cdd79aba135573c6ea800401040044cc00c00cd5d10011aba1001357426aae78dd50011aba135573c6ea800cd5d09aba235573c6ea800888c8c8cc004004010894ccd55cf8008b0a999ab9a3375e6aae74d5d080080189bab35573c6ae840044cc008008d5d10009ba900137540021f5f6",
			expectedTxType: 6,
		},
	}
	for _, testDef := range testDefs {
		txCbor, err := hex.DecodeString(testDef.txCborHex)
		if err != nil {
			t.Fatalf("unexpected error: %s", err)
		}
		tmpTxType, err := ledger.DetermineTransactionType(txCbor)
		if err != nil {
			t.Fatalf(
				"DetermineTransactionType failed with an unexpected error: %s",
				err,
			)
		}
		if tmpTxType != testDef.expectedTxType {
			t.Fatalf(
				"did not get expected TX type: got %d, wanted %d",
				tmpTxType,
				testDef.expectedTxType,
			)
		}
	}
}
